<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sanremo ‚Äì Votazione</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 20px;
      background:
        linear-gradient(rgba(10,10,40,0.85), rgba(10,10,40,0.85)),
        url("Logo_Festival_di_Sanremo_2026.svg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
    @media (max-width: 768px) {
      body { background-size: contain; background-position: top center; padding-top: 160px; }
    }
    h1,h2 { text-align: center; }
    .login, .vote, .results { max-width: 800px; margin: auto; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.4);}
    input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: none; font-size: 16px; }
    button { width: 100%; padding: 14px; background: gold; color: #000; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; font-weight: bold; margin-bottom:10px; }
    .artist { margin: 15px 0; }
    .artist label { display: block; margin-bottom: 6px; font-weight: bold; }
    .artist input[type=range] { width: 100%; }
    .score { text-align: right; font-size: 14px; opacity: 0.8; }
    .hidden { display: none; }
    .bar { background: linear-gradient(90deg, gold, orange); height: 26px; border-radius: 8px; margin: 6px 0; padding-left: 10px; line-height: 26px; color: #000; font-weight: bold; transition: width 1.2s ease-out; }
  </style>
</head>
<body>

<h1>üé§ Sanremo ‚Äì Votazione Finale</h1>

<div class="login" id="login">
  <h2>Inserisci i dati</h2>
  <input id="nickname" placeholder="Nickname" />
  <input id="code" placeholder="Codice" />
  <button onclick="startVote()">Inizia a votare</button>
  <button onclick="resetVotes()">Reset voti locali</button>
</div>

<div class="vote hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button onclick="submitVotes()">Invia voti</button>
</div>

<div class="results hidden" id="results">
  <h2>üèÜ Classifica Finale</h2>
  <div id="ranking"></div>
</div>

<!-- Firebase UMD compat -->
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore-compat.js"></script>
<script>
  // ----------------- Firebase -----------------
  const firebaseConfig = {
    apiKey: "AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
    authDomain: "sanremo-2026.firebaseapp.com",
    projectId: "sanremo-2026",
    storageBucket: "sanremo-2026.appspot.com",
    messagingSenderId: "585160817288",
    appId: "1:585160817288:web:71c4552fc2cfd73c9dfd3d"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ----------------- Dati e logica -----------------
  const SECRET_CODE = "SANREMO26";
  const artists = [
    "Arisa ‚Äì Magica favola","Bambole di Pezza ‚Äì Resta con me","Chiello ‚Äì Ti penso sempre",
    "Dargen D'Amico ‚Äì AI AI","Ditonellapiaga ‚Äì Che fastidio!","Eddie Brock ‚Äì Avvoltoi",
    "Elettra Lamborghini ‚Äì Voil√†","Enrico Nigiotti ‚Äì Ogni volta che non so volare",
    "Ermal Meta ‚Äì Stella stellina","Fedez & Marco Masini ‚Äì Male necessario",
    "Francesco Renga ‚Äì Il meglio di me","Fulminacci ‚Äì Stupida sfortuna",
    "J-Ax ‚Äì Italia","LDA & Aka7even ‚Äì Poesie clandestine","Leo Gassmann ‚Äì Naturale",
    "Levante ‚Äì Sei tu","Luch√® ‚Äì Labirinto","Malika Ayane ‚Äì Animali notturni",
    "Mara Sattei ‚Äì Le cose che non sai di me","Maria Antonietta & Colombre ‚Äì La felicit√† e basta",
    "Michele Bravi ‚Äì Prima o poi","Nayt ‚Äì Prima che","Patty Pravo ‚Äì Opera",
    "Raf ‚Äì Ora e per sempre","Sal Da Vinci ‚Äì Per sempre s√¨","Samurai Jay ‚Äì Ossessione",
    "Sayf ‚Äì Tu mi piaci tanto","Serena Brancale ‚Äì Qui con me",
    "Tommaso Paradiso ‚Äì I romantici","Tredici Pietro ‚Äì Uomo che cade"
  ];

  let votesData = JSON.parse(localStorage.getItem("votes") || "{}");
  let nickname = "";

  const artistsDiv = document.getElementById("artists");
  const rankingDiv = document.getElementById("ranking");

  function startVote() {
    nickname = document.getElementById("nickname").value.trim();
    const code = document.getElementById("code").value.trim();
    if (!nickname || code !== SECRET_CODE) return alert("Nickname o codice errato");
    if (votesData[nickname]) return alert("Hai gi√† votato!");
    document.getElementById("login").classList.add("hidden");
    document.getElementById("vote").classList.remove("hidden");
    renderArtists();
  }

  function renderArtists() {
    artistsDiv.innerHTML = "";
    artists.forEach((a,i) => {
      const div = document.createElement("div");
      div.className = "artist";
      div.innerHTML = `
        <label>${a}</label>
        <input type="range" min="1" max="10" value="1" id="a${i}" />
        <div class="score">Voto: <span id="s${i}">1</span></div>
      `;
      artistsDiv.appendChild(div);
      div.querySelector("input").oninput = e => {
        document.getElementById(`s${i}`).textContent = e.target.value;
      };
    });
  }

  async function submitVotes() {
    const userVotes = artists.map((_,i)=> +document.getElementById(`a${i}`).value);
    if (userVotes.includes(0)) return alert("Devi votare tutti i cantanti");
    votesData[nickname] = userVotes;
    localStorage.setItem("votes", JSON.stringify(votesData));
    document.getElementById("vote").classList.add("hidden");

    try {
      await db.collection("votes").add({ nickname, votes: userVotes, time: Date.now() });
      console.log("Voto inviato correttamente su Firebase!");
    } catch(e) { console.error("Errore Firebase:",e); alert("Errore nel salvataggio su Firebase"); }

    showResults();
  }

  function showResults() {
    rankingDiv.innerHTML = "";
    const totals = artists.map((a,i)=>{
      let sum=0,count=0;
      Object.values(votesData).forEach(v=>{ sum+=v[i]; count++; });
      return {name:a, avg: sum/count};
    }).sort((a,b)=>b.avg-a.avg);

    totals.forEach(t=>{
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.width = "0%";
      rankingDiv.appendChild(bar);
      setTimeout(()=>{ bar.style.width = (t.avg/10*100)+"%"; bar.textContent = `${t.name} ‚Äì ${t.avg.toFixed(2)}`; }, 50);
    });

    document.getElementById("results").classList.remove("hidden");
  }

  function resetVotes() {
    if(confirm("Vuoi davvero resettare tutti i voti locali?")) {
      localStorage.removeItem("votes");
      votesData = {};
      alert("Voti locali resettati!");
      window.location.reload();
    }
  }

  window.startVote = startVote;
  window.submitVotes = submitVotes;
  window.resetVotes = resetVotes;
</script>

</body>
</html>
