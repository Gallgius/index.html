<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanremo 2026 ‚Äì Votazione</title>
<style>
body {font-family: Arial, sans-serif;background: linear-gradient(180deg,#0b0b1e,#1c1c3c);color:#fff;margin:0;padding:20px;}
h1,h2{text-align:center;}
.box{max-width:800px;margin:auto;background:rgba(255,255,255,0.05);padding:20px;border-radius:12px;}
.hidden{display:none;}
input,button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none;font-size:16px;}
button{background:gold;color:#000;font-weight:bold;cursor:pointer;}
.artist{margin:15px 0;}
.score{text-align:right;}
.bar{background:linear-gradient(90deg,gold,orange);height:26px;border-radius:8px;margin:8px 0;padding-left:10px;line-height:26px;color:#000;font-weight:bold;transition:width 1.2s;}
#podium{display:flex;justify-content:center;gap:20px;margin-bottom:30px;}
.podium-box{width:30%;background:linear-gradient(180deg,gold,orange);color:#000;border-radius:12px;padding:15px;font-weight:bold;text-align:center;animation:drop 0.8s ease-out;}
@keyframes drop{from{transform:translateY(-40px);opacity:0;}to{transform:translateY(0);opacity:1;}}
</style>
</head>
<body>

<audio id="soundReveal" src="https://assets.mixkit.co/sfx/preview/mixkit-drum-roll-566.mp3"></audio>
<audio id="soundPodium" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

<h1>üé§ Sanremo 2026 ‚Äì Votazione</h1>

<div class="box" id="login">
  <h2>Accesso</h2>
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <h2>üèÜ Classifica Finale</h2>
  <div id="podium"></div>
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <div id="ranking"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain: "sanremo-2026.firebaseapp.com",
  projectId: "sanremo-2026",
  storageBucket: "sanremo-2026.firebasestorage.app",
  messagingSenderId: "585160817288",
  appId: "1:585160817288:web:71c4552fc2cfd73c9dfd3d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const PRESENTER_CODE = "SANREMO26";
let nickname = "";
let votes = [];

const artists = [
"Arisa","Bambole di Pezza","Chiello","Dargen D'Amico","Ditonellapiaga","Eddie Brock",
"Elettra Lamborghini","Enrico Nigiotti","Ermal Meta","Fedez & Marco Masini",
"Francesco Renga","Fulminacci","J-Ax","LDA & Aka7even","Leo Gassmann","Levante",
"Luch√®","Malika Ayane","Mara Sattei","Maria Antonietta & Colombre","Michele Bravi",
"Nayt","Patty Pravo","Raf","Sal Da Vinci","Samurai Jay","Sayf","Serena Brancale",
"Tommaso Paradiso","Tredici Pietro"
];

votes = Array(artists.length).fill(5);

function renderArtists() {
  const div = document.getElementById("artists");
  div.innerHTML = "";
  artists.forEach((a, i) => {
    const el = document.createElement("div");
    el.className = "artist";
    el.innerHTML = `
      <label>${a}</label>
      <input type="range" min="1" max="10" value="5">
      <div class="score">Voto: <span>5</span></div>`;
    const input = el.querySelector("input");
    const span = el.querySelector("span");
    input.oninput = () => { span.textContent = input.value; votes[i] = +input.value; };
    div.appendChild(el);
  });
}

function revealRanking(totals) {
  const ranking = document.getElementById("ranking");
  ranking.innerHTML = "";
  let i = totals.length - 1;
  function showNext() {
    if (i < 0) return;
    const t = totals[i];
    const bar = document.createElement("div");
    bar.className = "bar";
    bar.style.width = (t.avg * 8) + "%";
    bar.textContent = `${i+1}¬∞ ‚Äì ${t.name} ‚Äì ${t.avg.toFixed(2)}`;
    ranking.prepend(bar);
    document.getElementById("soundReveal").play();
    i--;
    setTimeout(showNext, 1200);
  }
  showNext();
}

window.start = () => {
  nickname = document.getElementById("nickname").value.trim();
  const code = document.getElementById("code").value.trim();
  if (!nickname || !code) return alert("Compila tutto");
  document.getElementById("login").classList.add("hidden");
  if (code === PRESENTER_CODE) {
    document.getElementById("presenter").classList.remove("hidden");
    startAutoUpdate();
  } else {
    document.getElementById("vote").classList.remove("hidden");
    renderArtists();
  }
};

window.submitVotes = async () => {
  await addDoc(collection(db, "votes"), { nickname, votes, time: Date.now() });
  alert("Voto inviato!");
};

window.showResults = async () => {
  const ranking = document.getElementById("ranking");
  const podium = document.getElementById("podium");
  ranking.innerHTML = ""; podium.innerHTML = "";
  const snap = await getDocs(collection(db, "votes"));
  const totals = artists.map((a, i) => {
    let sum = 0, count = 0;
    snap.forEach(d => { sum += d.data().votes[i]; count++; });
    return { name: a, avg: sum / count };
  }).sort((a,b)=>b.avg-a.avg);

  totals.slice(0,3).forEach((t, i) => {
    const div = document.createElement("div");
    div.className = "podium-box";
    div.innerHTML = `<div>${["ü•á","ü•à","ü•â"][i]}</div><div>${t.name}</div><div>${t.avg.toFixed(2)}</div>`;
    podium.appendChild(div);
  });
  document.getElementById("soundPodium").play();
  revealRanking(totals);
};

let autoUpdate = null;
function startAutoUpdate() {
  if (autoUpdate) clearInterval(autoUpdate);
  autoUpdate = setInterval(() => {
    if (!document.getElementById("presenter").classList.contains("hidden")) {
      showResults();
    }
  }, 15000);
}

document.getElementById("btnStart").addEventListener("click", window.start);
document.getElementById("btnSubmit").addEventListener("click", window.submitVotes);
document.getElementById("btnShow").addEventListener("click", window.showResults);
</script>
</body>
</html>
