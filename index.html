<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanremo 2026 ‚Äì Votazione</title>

<style>
body {
  font-family: Arial, sans-serif;
  color: white;
  margin: 0;
  padding: 20px;

  background:
    linear-gradient(
      rgba(10, 10, 40, 0.85),
      rgba(10, 10, 40, 0.85)
    ),
    url("Logo_Festival_di_Sanremo_2026.svg.png");

  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}
  @media (max-width: 768px) {
  body {
    background-size: contain;
    background-position: top center;
    padding-top: 160px;
  }
}
h1, h2 { text-align: center; }

.box {
  max-width: 800px;
  margin: auto;
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 12px;
}

.hidden { display: none; }

input, button {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  background: gold;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.artist { margin: 15px 0; }
.artist label { font-weight: bold; }
.score { text-align: right; }

.bar {
  background: linear-gradient(90deg, gold, orange);
  height: 26px;
  border-radius: 8px;
  margin: 8px 0;
  padding-left: 10px;
  line-height: 26px;
  color: #000;
  font-weight: bold;
  width: 0%;
  transition: width 1.2s ease-out;
}

#podium {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 30px;
}

.podium-box {
  width: 30%;
  background: linear-gradient(180deg, gold, orange);
  color: #000;
  border-radius: 12px;
  padding: 15px;
  font-weight: bold;
  text-align: center;
}

.podium-1 { font-size: 22px; }
.podium-2 { opacity: 0.85; }
.podium-3 { opacity: 0.7; }
</style>
</head>

<body>

<h1>üé§ Sanremo 2026 ‚Äì Votazione</h1>

<div class="box" id="login">
  <h2>Accesso</h2>
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <h2>üèÜ Classifica Finale</h2>
  <div id="podium"></div>
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReset">RESET VOTAZIONI</button>
  <div id="ranking"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// üî¥ Inserisci qui il tuo firebaseConfig
const firebaseConfig = {
  apiKey: "AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain: "sanremo-2026.firebaseapp.com",
  projectId: "sanremo-2026",
  storageBucket: "sanremo-2026.firebasestorage.app",
  messagingSenderId: "585160817288",
  appId: "1:585160817288:web:71c4552fc2cfd73c9dfd3d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// üîë Codici
const PRESENTER_CODE = "SANREMO26";
const VOTER_CODE = "VOTA26";

let nickname = "";
let votes = [];

const artists = [
"Arisa ‚Äì Magica favola","Bambole di Pezza ‚Äì Resta con me","Chiello ‚Äì Ti penso sempre",
"Dargen D'Amico ‚Äì AI AI","Ditonellapiaga ‚Äì Che fastidio!","Eddie Brock ‚Äì Avvoltoi",
"Elettra Lamborghini ‚Äì Voil√†","Enrico Nigiotti ‚Äì Ogni volta che non so volare",
"Ermal Meta ‚Äì Stella stellina","Fedez & Marco Masini ‚Äì Male necessario",
"Francesco Renga ‚Äì Il meglio di me","Fulminacci ‚Äì Stupida sfortuna","J-Ax ‚Äì Italia",
"LDA & Aka7even ‚Äì Poesie clandestine","Leo Gassmann ‚Äì Naturale","Levante ‚Äì Sei tu",
"Luch√® ‚Äì Labirinto","Malika Ayane ‚Äì Animali notturni","Mara Sattei ‚Äì Le cose che non sai di me",
"Maria Antonietta & Colombre ‚Äì La felicit√† e basta","Michele Bravi ‚Äì Prima o poi",
"Nayt ‚Äì Prima che","Patty Pravo ‚Äì Opera","Raf ‚Äì Ora e per sempre",
"Sal Da Vinci ‚Äì Per sempre s√¨","Samurai Jay ‚Äì Ossessione","Sayf ‚Äì Tu mi piaci tanto",
"Serena Brancale ‚Äì Qui con me","Tommaso Paradiso ‚Äì I romantici","Tredici Pietro ‚Äì Uomo che cade"
];

votes = Array(artists.length).fill(5);

// --- FUNZIONI ---
function renderArtists() {
  const div = document.getElementById("artists");
  div.innerHTML = "";
  artists.forEach((a, i) => {
    const el = document.createElement("div");
    el.className = "artist";
    el.innerHTML = `
      <label>${a}</label>
      <input type="range" min="1" max="10" value="5">
      <div class="score">Voto: <span>5</span></div>
    `;
    const input = el.querySelector("input");
    const span = el.querySelector("span");
    input.oninput = () => {
      span.textContent = input.value;
      votes[i] = +input.value;
    };
    div.appendChild(el);
  });
}

function animateBar(bar, target) {
  setTimeout(() => { bar.style.width = target + "%"; }, 50);
}

// --- Accesso ---
window.start = () => {
  nickname = document.getElementById("nickname").value.trim();
  const code = document.getElementById("code").value.trim();

  if (!nickname || !code) return alert("Compila tutto");

  document.getElementById("login").classList.add("hidden");

  if (code === PRESENTER_CODE) {
    document.getElementById("presenter").classList.remove("hidden");
  } else if (code === VOTER_CODE) {
    document.getElementById("vote").classList.remove("hidden");
    renderArtists();
  } else {
    alert("Codice errato");
    document.getElementById("login").classList.remove("hidden");
  }
};

// --- Invio voti con controllo nickname ---
window.submitVotes = async () => {
  try {
    // Controllo se nickname ha gi√† votato
    const snap = await getDocs(collection(db, "votes"));
    const exists = snap.docs.some(d => d.data().nickname === nickname);

    if (exists) {
      alert("Questo nickname ha gi√† votato!");
      return;
    }

    await addDoc(collection(db, "votes"), { nickname, votes, time: Date.now() });
    alert("Voti inviati!");
    document.getElementById("vote").classList.add("hidden");

  } catch(e) {
    console.error(e);
    alert("Errore invio voti");
  }
};

// --- Mostra classifica ---
window.showResults = async () => {
  const ranking = document.getElementById("ranking");
  const podium = document.getElementById("podium");

  ranking.innerHTML = "";
  podium.innerHTML = "";

  const snap = await getDocs(collection(db, "votes"));

  const totals = artists.map((a, i) => {
    let sum = 0, count = 0;
    snap.forEach(d => { sum += d.data().votes[i]; count++; });
    return { name: a, avg: count ? sum / count : 0 };
  }).sort((a,b)=>b.avg-b.avg);

  totals.slice(0,3).forEach((t, i) => {
    const div = document.createElement("div");
    div.className = `podium-box podium-${i+1}`;
    div.innerHTML = `
      <div>${["ü•á","ü•à","ü•â"][i]}</div>
      <div>${t.name}</div>
      <div>${t.avg.toFixed(2)}</div>
    `;
    podium.appendChild(div);
  });

  totals.forEach(t => {
    const bar = document.createElement("div");
    bar.className = "bar";
    bar.textContent = `${t.name} ‚Äì ${t.avg.toFixed(2)}`;
    ranking.appendChild(bar);
    animateBar(bar, t.avg * 8);
  });
};

// --- Reset votazioni ---
window.resetVotes = async () => {
  if (!confirm("Sei sicuro di voler resettare tutte le votazioni?")) return;

  try {
    const snap = await getDocs(collection(db, "votes"));
    const batch = [];
    snap.forEach(d => batch.push(deleteDoc(doc(db, "votes", d.id))));
    await Promise.all(batch);
    alert("Tutte le votazioni sono state resettate!");
    document.getElementById("podium").innerHTML = "";
    document.getElementById("ranking").innerHTML = "";
  } catch (e) {
    console.error(e);
    alert("Errore nel reset delle votazioni");
  }
};

// --- Event listener ---
document.getElementById("btnStart").addEventListener("click", window.start);
document.getElementById("btnSubmit").addEventListener("click", window.submitVotes);
document.getElementById("btnShow").addEventListener("click", window.showResults);
document.getElementById("btnReset").addEventListener("click", window.resetVotes);

</script>

</body>
</html>
