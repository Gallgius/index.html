<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Sanremo 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  color:white;
  padding:20px;
  min-height:100vh;
  background:url("sfondo.png") no-repeat center 25%;
  background-size:cover;
}

.box{max-width:800px;margin:auto;background:rgba(255,255,255,.05);padding:20px;border-radius:12px}
.hidden{display:none}
input,button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none;font-size:16px}
button{background:gold;color:black;font-weight:bold;cursor:pointer}
.artist{margin:10px 0}
.bar{background:linear-gradient(90deg,gold,orange);height:26px;border-radius:8px;margin:6px 0;line-height:26px;padding-left:10px;color:black;font-weight:bold;transition:width 1s}

#podium{display:flex;gap:20px;justify-content:center;margin:20px 0;flex-wrap:wrap}
.podium-box{
  width:30%;
  background:gold;
  color:black;
  padding:15px;
  border-radius:12px;
  text-align:center;
  font-weight:bold;
}

.logo-normal{max-width:250px;width:80%;margin:20px auto;display:block}
.logo-presenter{max-width:500px;width:90%;margin:40px auto;display:block;box-shadow:0 0 25px gold}

#logo{position:relative;z-index:10}

/* ===== MODALITÃ€ REGIA ===== */
.regia button,
.regia input,
.regia h1 {
  display:none !important;
}
.regia .box{
  background:none;
}
</style>
</head>

<body>

<h1>ðŸŽ¤ Sanremo 2026</h1>
<img id="logo" src="Logo_Festival_di_Sanremo_2026.svg.png" class="logo-normal">

<div class="box" id="login">
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti (1â€“10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReveal">RIVELA PODIO</button>
  <button id="btnReset">RESET VOTI</button>
  <div id="podium" class="hidden"></div>
  <div id="ranking"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== FIREBASE ===== */
const firebaseConfig={
  apiKey:"AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain:"sanremo-2026.firebaseapp.com",
  projectId:"sanremo-2026",
  storageBucket:"sanremo-2026.appspot.com",
  messagingSenderId:"585160817288",
  appId:"1:585160817288:web:71c4552fc2cfd73c9dfd3d"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* ===== DATI ===== */
const PRESENTER_CODE="SANREMO26";
const artists=[ "Arisa â€“ Magica favola","Bambole di Pezza â€“ Resta con me","Chiello â€“ Ti penso sempre","Dargen D'Amico â€“ AI AI","Ditonellapiaga â€“ Che fastidio!","Eddie Brock â€“ Avvoltoi","Elettra Lamborghini â€“ VoilÃ ","Enrico Nigiotti â€“ Ogni volta che non so volare","Ermal Meta â€“ Stella stellina","Fedez & Marco Masini â€“ Male necessario","Francesco Renga â€“ Il meglio di me","Fulminacci â€“ Stupida sfortuna","J-Ax â€“ Italia","LDA & Aka7even â€“ Poesie clandestine","Leo Gassmann â€“ Naturale","Levante â€“ Sei tu","LuchÃ¨ â€“ Labirinto","Malika Ayane â€“ Animali notturni","Mara Sattei â€“ Le cose che non sai di me","Maria Antonietta & Colombre â€“ La felicitÃ  e basta","Michele Bravi â€“ Prima o poi","Nayt â€“ Prima che","Patty Pravo â€“ Opera","Raf â€“ Ora e per sempre","Sal Da Vinci â€“ Per sempre sÃ¬","Samurai Jay â€“ Ossessione","Sayf â€“ Tu mi piaci tanto","Serena Brancale â€“ Qui con me","Tommaso Paradiso â€“ I romantici","Tredici Pietro â€“ Uomo che cade" ];

let votes=Array(artists.length).fill(5);
let hasVoted=false;
let top3=[];

/* ===== LOGIN ===== */
btnStart.onclick=()=>{
  if(!nickname.value||!code.value)return alert("Compila tutto");
  login.classList.add("hidden");
  if(code.value===PRESENTER_CODE){
    presenter.classList.remove("hidden");
    logo.className="logo-presenter";
  }else{
    vote.classList.remove("hidden");
    renderArtists();
  }
};

/* ===== VOTAZIONE ===== */
function renderArtists(){
  artistsDiv.innerHTML="";
  artists.forEach((a,i)=>{
    const d=document.createElement("div");
    d.className="artist";
    d.innerHTML=`${a}<input type="range" min="1" max="10" value="1"><span> 1</span>`;
    const r=d.querySelector("input");
    const s=d.querySelector("span");
    r.oninput=()=>{s.textContent=" "+r.value;votes[i]=+r.value};
    artistsDiv.appendChild(d);
  });
}

btnSubmit.onclick=async()=>{
  if(hasVoted)return;
  await addDoc(collection(db,"votes"),{votes});
  hasVoted=true;
  alert("Voto inviato!");
  vote.classList.add("hidden");
};

/* ===== CLASSIFICA ===== */
async function calcolaClassifica(){
  const snap=await getDocs(collection(db,"votes"));
  let totals=artists.map((a,i)=>{
    let sum=0,count=0;
    snap.forEach(d=>{
      if(d.data().votes?.[i]!=null){sum+=d.data().votes[i];count++}
    });
    return {name:a,avg:count?sum/count:0};
  }).sort((a,b)=>a.avg-b.avg);

  top3=totals.slice(-3).reverse();
  return totals.slice(0,-3);
}

btnShow.onclick=async()=>{
  ranking.innerHTML="";
  const others=await calcolaClassifica();
  others.forEach((t,i)=>{
    const bar=document.createElement("div");
    bar.className="bar";
    bar.style.width=(t.avg*10)+"%";
    bar.textContent=`${others.length-i+3}. ${t.name} â€“ ${t.avg.toFixed(2)}`;
    ranking.appendChild(bar);
  });
};

/* ===== EFFETTI ===== */
function goFullScreen(){
  document.documentElement.requestFullscreen?.();
}
function enterRegia(){
  document.body.classList.add("regia");
}
function playBeep(){
  const ctx=new AudioContext();
  const o=ctx.createOscillator();
  o.frequency.value=800;o.connect(ctx.destination);
  o.start();setTimeout(()=>{o.stop();ctx.close()},150);
}
function goldExplosion(){
  for(let i=0;i<60;i++){
    const p=document.createElement("div");
    p.style.cssText="position:fixed;width:8px;height:8px;background:gold;border-radius:50%;top:-10px;left:"+Math.random()*100+"vw;z-index:9999";
    document.body.appendChild(p);
    p.animate([{transform:"translateY(0)"},{transform:"translateY(100vh)",opacity:0}],{duration:2000});
    setTimeout(()=>p.remove(),2500);
  }
}

/* ===== PODIO REGIA ===== */
btnReveal.onclick=async()=>{
  goFullScreen();
  enterRegia();
  await calcolaClassifica();

  podium.innerHTML="";
  podium.classList.remove("hidden");

  const order=[2,1,0];
  let i=0;

  function next(){
    if(i>=3)return;
    const t=top3[order[i]];
    const d=document.createElement("div");
    d.className="podium-box";
    d.innerHTML=`<div style="font-size:60px">${["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][order[i]]}</div><div>${t.name}</div><div>${t.avg.toFixed(2)}</div>`;
    podium.appendChild(d);
    playBeep(); goldExplosion();
    i++; setTimeout(next,2000);
  }
  next();
};

/* ===== RESET ===== */
btnReset.onclick=async()=>{
  if(!confirm("Cancellare voti?"))return;
  const snap=await getDocs(collection(db,"votes"));
  for(const d of snap.docs)await deleteDoc(doc(db,"votes",d.id));
  ranking.innerHTML=""; podium.innerHTML="";
  hasVoted=false;
  alert("Reset completato");
};
</script>
</body>
</html>
