<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Sanremo ‚Äì Votazione Finale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #0b0b1e, #1c1c3c);
      color: white;
      padding: 20px;
    }
    h1, h2 { text-align: center; }
    .box {
      max-width: 900px;
      margin: auto;
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 14px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }
    button {
      background: gold;
      font-weight: bold;
      cursor: pointer;
    }
    .artist { margin: 14px 0; }
    .bar {
      background: linear-gradient(90deg, gold, orange);
      height: 26px;
      border-radius: 8px;
      margin: 6px 0;
      padding-left: 10px;
      line-height: 26px;
      color: black;
      font-weight: bold;
      animation: grow 1.2s ease-out;
    }
    @keyframes grow { from { width: 0; } }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>üé§ Sanremo ‚Äì Votazione Finale</h1>

<div class="box" id="login">
  <h2>Accesso</h2>
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button onclick="start()">Inizia</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button onclick="sendVotes()">Invia voti</button>
</div>

<div class="box hidden" id="admin">
  <h2>üèÜ Classifica Finale</h2>
  <button onclick="showResults()">MOSTRA CLASSIFICA</button>
  <div id="ranking"></div>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    // üî¥ INCOLLA QUI LA CONFIG CHE TI HA DATO FIREBASE
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const SECRET_CODE = "SANREMO25";

  const artistsList = [
    "Arisa ‚Äì Magica favola",
    "Bambole di Pezza ‚Äì Resta con me",
    "Chiello ‚Äì Ti penso sempre",
    "Dargen D'Amico ‚Äì AI AI",
    "Ditonellapiaga ‚Äì Che fastidio!",
    "Eddie Brock ‚Äì Avvoltoi",
    "Elettra Lamborghini ‚Äì Voil√†",
    "Enrico Nigiotti ‚Äì Ogni volta che non so volare",
    "Ermal Meta ‚Äì Stella stellina",
    "Fedez & Marco Masini ‚Äì Male necessario",
    "Francesco Renga ‚Äì Il meglio di me",
    "Fulminacci ‚Äì Stupida sfortuna",
    "J-Ax ‚Äì Italia",
    "LDA & Aka7even ‚Äì Poesie clandestine",
    "Leo Gassmann ‚Äì Naturale",
    "Levante ‚Äì Sei tu",
    "Luch√® ‚Äì Labirinto",
    "Malika Ayane ‚Äì Animali notturni",
    "Mara Sattei ‚Äì Le cose che non sai di me",
    "Maria Antonietta & Colombre ‚Äì La felicit√† e basta",
    "Michele Bravi ‚Äì Prima o poi",
    "Nayt ‚Äì Prima che",
    "Patty Pravo ‚Äì Opera",
    "Raf ‚Äì Ora e per sempre",
    "Sal Da Vinci ‚Äì Per sempre s√¨",
    "Samurai Jay ‚Äì Ossessione",
    "Sayf ‚Äì Tu mi piaci tanto",
    "Serena Brancale ‚Äì Qui con me",
    "Tommaso Paradiso ‚Äì I romantici",
    "Tredici Pietro ‚Äì Uomo che cade"
  ];

  window.start = () => {
    if (code.value !== SECRET_CODE || !nickname.value) {
      alert("Codice o nickname errato");
      return;
    }
    login.classList.add("hidden");
    vote.classList.remove("hidden");
    admin.classList.remove("hidden");
    artistsList.forEach((a,i)=>{
      artists.innerHTML += `
        <div class="artist">
          <b>${a}</b><br>
          <input type="range" min="1" max="10" value="5" id="v${i}">
        </div>`;
    });
  };

  window.sendVotes = async () => {
    const votes = artistsList.map((_,i)=>+document.getElementById("v"+i).value);
    await addDoc(collection(db, "votes"), { votes });
    alert("Voto inviato!");
    vote.classList.add("hidden");
  };

  window.showResults = async () => {
    ranking.innerHTML = "";
    const snap = await getDocs(collection(db, "votes"));
    const totals = artistsList.map((a,i)=>{
      let sum=0, c=0;
      snap.forEach(d=>{ sum+=d.data().votes[i]; c++; });
      return { name:a, avg:sum/c };
    }).sort((a,b)=>b.avg-a.avg);

    totals.forEach(t=>{
      const div=document.createElement("div");
      div.className="bar";
      div.style.width=(t.avg*8)+"%";
      div.textContent=`${t.name} ‚Äì ${t.avg.toFixed(2)}`;
      ranking.appendChild(div);
    });
  };
</script>
</body>
</html>

