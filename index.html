<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Sanremo 2026 ‚Äì Finalissima</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  color:white;
  min-height:100vh;
  background:url("sfondo.png") no-repeat center 25%;
  background-size:cover;
}

.hidden{display:none}

.box{
  max-width:1000px;
  margin:auto;
  background:rgba(0,0,0,.5);
  padding:25px;
  border-radius:14px;
}

/* BOTTONI */
input,button{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:8px;
  border:none;
  font-size:16px
}
button{
  background:gold;
  color:black;
  font-weight:bold;
  cursor:pointer
}

/* CLASSIFICA */
.bar{
  background:linear-gradient(90deg,gold,orange);
  height:30px;
  border-radius:10px;
  margin:8px 0;
  padding-left:10px;
  line-height:30px;
  color:black;
  font-weight:bold;
  width:0;
  transition:width 1s;
}

/* PODIO */
#podium{
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:30px;
  margin-top:40px;
}

.podium-box{
  background:gold;
  color:black;
  padding:20px;
  border-radius:18px;
  text-align:center;
  font-weight:bold;
  opacity:0;
  transform:translateY(60px);
  transition:all .8s ease;
  box-shadow:0 0 20px rgba(255,215,0,.8);
}

.third{height:160px;width:180px;}
.second{height:200px;width:200px;}
.first{
  height:260px;
  width:240px;
  font-size:22px;
  background:linear-gradient(45deg,gold,orange);
  animation:goldPulse 1.5s infinite alternate;
}

@keyframes goldPulse{
  from{box-shadow:0 0 20px gold;}
  to{box-shadow:0 0 60px orange;}
}

/* VINCITORE */
#winnerTitle{
  text-align:center;
  font-size:48px;
  font-weight:bold;
  color:gold;
  margin-top:30px;
  opacity:0;
  transform:scale(.8);
  transition:all 1s ease;
}
</style>
</head>

<body>

<div class="box" id="login">
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice votante / Presentatore">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReveal">RIVELA PODIO</button>
  <button id="btnReset">RESET</button>
  <div id="ranking"></div>
  <div id="podium" class="hidden"></div>
  <div id="winnerTitle"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"sanremo-2026.firebaseapp.com",
  projectId:"sanremo-2026",
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* CONFIG */
const PRESENTER_CODE="SANREMO26";
const VOTER_CODE="VOTO26";

const artists=[
  {name:"Artista 1"},
  {name:"Artista 2"},
  {name:"Artista 3"},
  {name:"Artista 4"},
  {name:"Artista 5"}
];

let votes=Array(artists.length).fill(5);
let top3=[];

/* ELEMENTI */
const login=document.getElementById("login");
const voteBox=document.getElementById("vote");
const presenter=document.getElementById("presenter");
const artistsDiv=document.getElementById("artists");
const ranking=document.getElementById("ranking");
const podium=document.getElementById("podium");
const winnerTitle=document.getElementById("winnerTitle");

/* LOGIN */
btnStart.onclick=()=>{
  if(!nickname.value||!code.value){alert("Compila tutto");return;}
  login.classList.add("hidden");
  if(code.value===PRESENTER_CODE) presenter.classList.remove("hidden");
  else if(code.value===VOTER_CODE){voteBox.classList.remove("hidden");renderArtists();}
  else{alert("Codice non valido");login.classList.remove("hidden");}
};

/* SLIDER */
function renderArtists(){
  artistsDiv.innerHTML="";
  artists.forEach((a,i)=>{
    const d=document.createElement("div");
    d.innerHTML=`
      <strong>${a.name}</strong><br>
      <input type="range" min="1" max="10" value="5">
      <span> 5</span>
    `;
    const r=d.querySelector("input");
    const s=d.querySelector("span");

    const update=()=>{
      const p=((r.value-1)/9)*100;
      r.style.background=`linear-gradient(to right,gold 0%,gold ${p}%,#ddd ${p}%,#ddd 100%)`;
      s.textContent=" "+r.value;
      votes[i]=+r.value;
    };
    r.addEventListener("input",update);
    update();
    artistsDiv.appendChild(d);
  });
}

/* INVIO */
btnSubmit.onclick=async()=>{
  await addDoc(collection(db,"votes"),{votes});
  alert("Voto inviato!");
  voteBox.classList.add("hidden");
};

/* CALCOLO */
async function calcola(){
  const snap=await getDocs(collection(db,"votes"));
  let res=artists.map((a,i)=>{
    let s=0,c=0;
    snap.forEach(d=>{
      if(d.data().votes[i]!=null){s+=d.data().votes[i];c++;}
    });
    return{name:a.name,avg:c?s/c:0};
  }).sort((a,b)=>a.avg-b.avg);

  top3=res.slice(-3).reverse();
  return res.slice(0,res.length-3);
}

/* CLASSIFICA 30 ‚Üí 4 */
btnShow.onclick=async()=>{
  podium.classList.add("hidden");
  winnerTitle.style.opacity=0;
  ranking.innerHTML="";
  ranking.classList.remove("hidden");

  const others=await calcola();
  let pos=artists.length;
  let i=0;

  function reveal(){
    if(i>=others.length)return;
    const t=others[i];
    const bar=document.createElement("div");
    bar.className="bar";
    bar.textContent=`${pos}. ${t.name} ‚Äì ${t.avg.toFixed(2)}`;
    ranking.appendChild(bar);
    requestAnimationFrame(()=>bar.style.width=(t.avg*10)+"%");
    pos--; i++;
    setTimeout(reveal,400);
  }
  reveal();
};

/* FINALISSIMA */
btnReveal.onclick=async()=>{
  ranking.classList.add("hidden");
  ranking.innerHTML="";
  await calcola();

  podium.innerHTML="";
  podium.classList.remove("hidden");

  const order=[
    {index:2,class:"third",medal:"ü•â"},
    {index:1,class:"second",medal:"ü•à"},
    {index:0,class:"first",medal:"ü•á"}
  ];

  let i=0;

  function showNext(){
    if(i>=3){
      winnerTitle.innerHTML="üèÜ VINCITORE üèÜ<br>"+top3[0].name;
      winnerTitle.style.opacity=1;
      winnerTitle.style.transform="scale(1)";
      return;
    }

    const o=order[i];
    const t=top3[o.index];

    const box=document.createElement("div");
    box.className="podium-box "+o.class;
    box.innerHTML=`
      ${o.medal}<br>
      ${t.name}<br>
      ${t.avg.toFixed(2)}
    `;

    podium.appendChild(box);

    requestAnimationFrame(()=>{
      box.style.opacity=1;
      box.style.transform="translateY(0)";
    });

    i++;
    setTimeout(showNext,1500);
  }

  showNext();
};

/* RESET */
btnReset.onclick=async()=>{
  if(!confirm("Reset totale?"))return;
  const snap=await getDocs(collection(db,"votes"));
  for(const d of snap.docs)await deleteDoc(doc(db,"votes",d.id));
  ranking.innerHTML="";
  podium.innerHTML="";
  winnerTitle.innerHTML="";
  alert("Reset fatto");
};
</script>
</body>
</html>
