<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanremo 2026 ‚Äì Votazione</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #0b0b1e, #1c1c3c);
  color: #fff;
  margin: 0;
  padding: 20px;
}
h1, h2 { text-align: center; }

.box {
  max-width: 800px;
  margin: auto;
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 12px;
}

.hidden { display: none; }

input, button {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  background: gold;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.artist { margin: 15px 0; }
.artist label { font-weight: bold; }
.score { text-align: right; }

.bar {
  background: linear-gradient(90deg, gold, orange);
  height: 26px;
  border-radius: 8px;
  margin: 8px 0;
  padding-left: 10px;
  line-height: 26px;
  color: #000;
  font-weight: bold;
  animation: grow 1s ease-out;
}

@keyframes grow {
  from { width: 0; }
}
</style>
</head>

<body>

<h1>üé§ Sanremo 2026 ‚Äì Votazione</h1>

<div class="box" id="login">
  <h2>Accesso</h2>
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button onclick="start()">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1‚Äì10)</h2>
  <div id="artists"></div>
  <button onclick="submitVotes()">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <h2>üèÜ Classifica Finale</h2>
  <button onclick="showResults()">MOSTRA CLASSIFICA</button>
  <div id="ranking"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî¥ INCOLLA QUI IL TUO firebaseConfig */
const firebaseConfig = {
  apiKey: "AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain: "sanremo-2026.firebaseapp.com",
  projectId: "sanremo-2026",
  storageBucket: "sanremo-2026.firebasestorage.app",
  messagingSenderId: "585160817288",
  appId: "1:585160817288:web:71c4552fc2cfd73c9dfd3d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const PRESENTER_CODE = "SANREMO26";
let nickname = "";
let votes = [];

const artists = [
"Arisa ‚Äì Magica favola",
"Bambole di Pezza ‚Äì Resta con me",
"Chiello ‚Äì Ti penso sempre",
"Dargen D'Amico ‚Äì AI AI",
"Ditonellapiaga ‚Äì Che fastidio!",
"Eddie Brock ‚Äì Avvoltoi",
"Elettra Lamborghini ‚Äì Voil√†",
"Enrico Nigiotti ‚Äì Ogni volta che non so volare",
"Ermal Meta ‚Äì Stella stellina",
"Fedez & Marco Masini ‚Äì Male necessario",
"Francesco Renga ‚Äì Il meglio di me",
"Fulminacci ‚Äì Stupida sfortuna",
"J-Ax ‚Äì Italia",
"LDA & Aka7even ‚Äì Poesie clandestine",
"Leo Gassmann ‚Äì Naturale",
"Levante ‚Äì Sei tu",
"Luch√® ‚Äì Labirinto",
"Malika Ayane ‚Äì Animali notturni",
"Mara Sattei ‚Äì Le cose che non sai di me",
"Maria Antonietta & Colombre ‚Äì La felicit√† e basta",
"Michele Bravi ‚Äì Prima o poi",
"Nayt ‚Äì Prima che",
"Patty Pravo ‚Äì Opera",
"Raf ‚Äì Ora e per sempre",
"Sal Da Vinci ‚Äì Per sempre s√¨",
"Samurai Jay ‚Äì Ossessione",
"Sayf ‚Äì Tu mi piaci tanto",
"Serena Brancale ‚Äì Qui con me",
"Tommaso Paradiso ‚Äì I romantici",
"Tredici Pietro ‚Äì Uomo che cade"
];

votes = Array(artists.length).fill(0);

window.start = () => {
  nickname = document.getElementById("nickname").value.trim();
  const code = document.getElementById("code").value.trim();

  if (!nickname || !code) return alert("Compila tutto");

  document.getElementById("login").classList.add("hidden");

  if (code === PRESENTER_CODE) {
    document.getElementById("presenter").classList.remove("hidden");
  } else {
    document.getElementById("vote").classList.remove("hidden");
    renderArtists();
  }
};

function renderArtists() {
  const div = document.getElementById("artists");
  div.innerHTML = "";

  artists.forEach((a, i) => {
    const el = document.createElement("div");
    el.className = "artist";
    el.innerHTML = `
      <label>${a}</label>
      <input type="range" min="1" max="10" value="5">
      <div class="score">Voto: <span>5</span></div>
    `;
    const input = el.querySelector("input");
    const span = el.querySelector("span");
    input.oninput = () => {
      span.textContent = input.value;
      votes[i] = +input.value;
    };
    votes[i] = 5;
    div.appendChild(el);
  });
}

window.submitVotes = async () => {
  await addDoc(collection(db, "votes"), {
    nickname,
    votes,
    time: Date.now()
  });
  alert("Voto inviato!");
};

window.showResults = async () => {
  const ranking = document.getElementById("ranking");
  ranking.innerHTML = "";

  const snap = await getDocs(collection(db, "votes"));

  const totals = artists.map((a, i) => {
    let sum = 0, count = 0;
    snap.forEach(d => {
      sum += d.data().votes[i];
      count++;
    });
    return { name: a, avg: sum / count };
  }).sort((a,b)=>b.avg-a.avg);

  totals.forEach(t => {
    const bar = document.createElement("div");
    bar.className = "bar";
    bar.style.width = (t.avg * 8) + "%";
    bar.textContent = `${t.name} ‚Äì ${t.avg.toFixed(2)}`;
    ranking.appendChild(bar);
  });
};
</script>

</body>
</html>

