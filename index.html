<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanremo 2026</title>

<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  font-family:Arial;
  background:#000;
  color:white;
}
.hidden{display:none}

.box{
  max-width:800px;
  width:95%;
  margin:auto;
  background:rgba(255,255,255,.06);
  padding:20px;
  border-radius:12px;
}

input,button{
  width:100%;
  padding:14px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
button{
  background:gold;
  color:black;
  font-weight:bold;
  cursor:pointer;
}

/* LOGHI */
.logos{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:15px;
  margin:20px 0;
}
.logos img{
  max-width:260px;
  width:80%;
}

/* LOGIN FULL */
#login{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:15px;
}

/* CLASSIFICA */
.bar{
  background:linear-gradient(90deg,gold,orange);
  height:26px;
  border-radius:8px;
  margin:6px 0;
  padding-left:10px;
  line-height:26px;
  color:black;
  font-weight:bold;
  width:5%;
  transition:width 1s;
}

/* PODIO */
#podium{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:30px;
}
.podium-box{
  width:30%;
  background:gold;
  color:black;
  padding:20px;
  border-radius:12px;
  text-align:center;
  font-weight:bold;
  animation:drop .6s ease;
}
@keyframes drop{
  from{transform:translateY(-40px);opacity:0}
  to{transform:none;opacity:1}
}

/* ORO */
.gold{
  animation:flash .5s alternate 6;
}
@keyframes flash{
  from{box-shadow:0 0 10px gold}
  to{box-shadow:0 0 40px gold}
}

/* COUNTDOWN */
#countdown{
  font-size:100px;
  font-weight:bold;
  text-align:center;
  margin:40px 0;
}
</style>
</head>

<body>

<div class="logos">
  <img src="Logo_Festival_di_Sanremo_2026.svg.png">
  <img src="logo cinema.png">
</div>

<div class="box" id="login">
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti (1â€“10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReveal">RIVELA PODIO</button>
  <div id="ranking"></div>
  <div id="countdown" class="hidden"></div>
  <div id="podium" class="hidden"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app=initializeApp({
  apiKey:"AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain:"sanremo-2026.firebaseapp.com",
  projectId:"sanremo-2026"
});
const db=getFirestore(app);

const PRESENTER_CODE="SANREMO26";

/* ARTISTI */
const artists=[ "Arisa â€“ Magica favola","Bambole di Pezza â€“ Resta con me","Chiello â€“ Ti penso sempre",
"Dargen D'Amico â€“ AI AI","Ditonellapiaga â€“ Che fastidio!","Eddie Brock â€“ Avvoltoi",
"Elettra Lamborghini â€“ VoilÃ ","Enrico Nigiotti â€“ Ogni volta che non so volare",
"Ermal Meta â€“ Stella stellina","Fedez & Marco Masini â€“ Male necessario",
"Francesco Renga â€“ Il meglio di me","Fulminacci â€“ Stupida sfortuna","J-Ax â€“ Italia",
"LDA & Aka7even â€“ Poesie clandestine","Leo Gassmann â€“ Naturale","Levante â€“ Sei tu",
"LuchÃ¨ â€“ Labirinto","Malika Ayane â€“ Animali notturni","Mara Sattei â€“ Le cose che non sai di me",
"Maria Antonietta & Colombre â€“ La felicitÃ  e basta","Michele Bravi â€“ Prima o poi",
"Nayt â€“ Prima che","Patty Pravo â€“ Opera","Raf â€“ Ora e per sempre",
"Sal Da Vinci â€“ Per sempre sÃ¬","Samurai Jay â€“ Ossessione","Sayf â€“ Tu mi piaci tanto",
"Serena Brancale â€“ Qui con me","Tommaso Paradiso â€“ I romantici","Tredici Pietro â€“ Uomo che cade" ];

let votes=Array(artists.length).fill(5);
let top3=[];

/* LOGIN */
btnStart.onclick=()=>{
  login.classList.add("hidden");
  if(code.value===PRESENTER_CODE) presenter.classList.remove("hidden");
  else{ vote.classList.remove("hidden"); render(); }
};

/* VOTI */
function render(){
  artistsDiv.innerHTML="";
  artists.forEach((a,i)=>{
    const d=document.createElement("div");
    d.innerHTML=`${a}<input type="range" min="1" max="10" value="5"><span> 5</span>`;
    const r=d.querySelector("input"),s=d.querySelector("span");
    r.oninput=()=>{s.textContent=" "+r.value;votes[i]=+r.value;}
    artistsDiv.appendChild(d);
  });
}

btnSubmit.onclick=async()=>{
  await addDoc(collection(db,"votes"),{votes});
  alert("Voto inviato");
};

/* CALCOLO */
async function calcola(){
  const snap=await getDocs(collection(db,"votes"));
  let t=artists.map((a,i)=>{
    let s=0,c=0;
    snap.forEach(d=>{const v=d.data().votes?.[i];if(v){s+=v;c++;}});
    return {name:a,avg:c?s/c:0};
  }).sort((a,b)=>a.avg-b.avg);
  top3=t.slice(-3).reverse();
  return t.slice(0,-3);
}

/* CLASSIFICA */
btnShow.onclick=async()=>{
  ranking.innerHTML="";
  ranking.classList.remove("hidden");
  const o=await calcola();
  let i=0;
  const timer=setInterval(()=>{
    if(i>=o.length) return clearInterval(timer);
    const t=o[i];
    const b=document.createElement("div");
    b.className="bar";
    b.textContent=`${o.length-i+3}. ${t.name}`;
    ranking.appendChild(b);
    setTimeout(()=>b.style.width=(t.avg*10)+"%",100);
    i++;
  },1500);
};

/* BEEP */
function beep(){
  const ctx=new AudioContext();
  const o=ctx.createOscillator();
  o.frequency.value=800;
  o.connect(ctx.destination);
  o.start();
  setTimeout(()=>{o.stop();ctx.close()},120);
}

/* PODIO */
btnReveal.onclick=async()=>{
  ranking.innerHTML="";
  ranking.classList.add("hidden");

  document.documentElement.requestFullscreen?.();

  const countdown=document.getElementById("countdown");
  countdown.classList.remove("hidden");
  let n=10;

  const timer=setInterval(()=>{
    countdown.textContent=n;
    beep();
    n--;
    if(n<0){
      clearInterval(timer);
      countdown.classList.add("hidden");
      showPodio();
    }
  },1000);
};

function showPodio(){
  podium.innerHTML="";
  podium.classList.remove("hidden");
  const order=[2,1,0];
  let i=0;
  function next(){
    if(i>=3) return;
    const t=top3[order[i]];
    const d=document.createElement("div");
    d.className="podium-box gold";
    d.innerHTML=`<div style="font-size:60px">${["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][order[i]]}</div>
                 <div>${t.name}</div>
                 <div>${t.avg.toFixed(2)}</div>`;
    podium.appendChild(d);
    i++; setTimeout(next,2000);
  }
  next();
}
</script>
</body>
</html>
