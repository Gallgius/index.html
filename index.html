<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Sanremo 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  color:white;
  min-height:100vh;
  background:url("sfondo.png") no-repeat center 25%;
  background-size:cover;
}

.hidden{display:none}

/* ===== LOGHI ===== */
#logos{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0;
  margin-bottom:0;
}
#logos img{
  max-width:520px;
  width:90%;
}

/* ===== BOX ===== */
.box{
  max-width:900px;
  margin:auto;
  background:rgba(0,0,0,.45);
  padding:25px;
  border-radius:14px;
}

input,button{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:8px;
  border:none;
  font-size:16px
}
button{
  background:gold;
  color:black;
  font-weight:bold;
  cursor:pointer
}

/* ===== CLASSIFICA ===== */
.bar{
  background:linear-gradient(90deg,gold,orange);
  height:28px;
  border-radius:10px;
  margin:8px 0;
  padding-left:10px;
  line-height:28px;
  color:black;
  font-weight:bold;
  width:0;
  transition:width 1s;
}

/* ===== PODIO ===== */
#podium{
  display:flex;
  justify-content:center;
  gap:20px;
  margin:30px 0;
}
.podium-box{
  background:gold;
  color:black;
  padding:20px;
  border-radius:16px;
  text-align:center;
  width:30%;
  font-weight:bold;
  font-size:18px;
}

/* ===== COUNTDOWN ===== */
#countdown{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:140px;
  font-weight:bold;
  color:gold;
  z-index:9999;
}

/* ===== REGIA ===== */
.regia input,
.regia button,
.regia h1{
  display:none!important;
}
.regia .box{
  background:none;
}
</style>
</head>

<body>

<div id="logos">
  <img src="logo-sanremo-2026.png">
  <img src="logo-cinema.png">
</div>

<div class="box" id="login">
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1â€“10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReveal">RIVELA PODIO</button>
  <button id="btnReset">RESET</button>
  <div id="ranking"></div>
  <div id="podium" class="hidden"></div>
</div>

<div id="countdown" class="hidden">10</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== FIREBASE ===== */
const app=initializeApp({
  apiKey:"AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain:"sanremo-2026.firebaseapp.com",
  projectId:"sanremo-2026"
});
const db=getFirestore(app);

/* ===== CONFIG ===== */
const PRESENTER_CODE="SANREMO26";
const artists=[ "Arisa","Bambole di Pezza","Chiello","Dargen D'Amico","Ditonellapiaga",
"Eddie Brock","Elettra Lamborghini","Enrico Nigiotti","Ermal Meta","Fedez & Masini",
"Francesco Renga","Fulminacci","J-Ax","LDA & Aka7even","Leo Gassmann",
"Levante","LuchÃ¨","Malika Ayane","Mara Sattei","Maria Antonietta",
"Michele Bravi","Nayt","Patty Pravo","Raf","Sal Da Vinci",
"Samurai Jay","Sayf","Serena Brancale","Tommaso Paradiso","Tredici Pietro" ];

let votes=Array(artists.length).fill(5);
let top3=[];

/* ===== AUDIO ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function beep(freq=800, dur=0.15){
  const o=audioCtx.createOscillator();
  o.frequency.value=freq;
  o.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime+dur);
}

function drumRoll(){
  let i=0;
  const roll=setInterval(()=>{
    beep(200+i*30,0.08);
    i++;
    if(i>15) clearInterval(roll);
  },120);
}

/* ===== LOGIN ===== */
btnStart.onclick=()=>{
  if(!nickname.value||!code.value)return alert("Compila tutto");
  login.classList.add("hidden");
  code.value===PRESENTER_CODE
    ? presenter.classList.remove("hidden")
    : (vote.classList.remove("hidden"),renderArtists());
};

/* ===== VOTO ===== */
function renderArtists(){
  artistsDiv.innerHTML="";
  artists.forEach((a,i)=>{
    artistsDiv.innerHTML+=`${a}
    <input type="range" min="1" max="10" value="1"
    oninput="this.nextSibling.textContent=this.value;votes[${i}]=+this.value">
    <span>1</span><br>`;
  });
}

btnSubmit.onclick=async()=>{
  await addDoc(collection(db,"votes"),{votes});
  alert("Voto inviato!");
  vote.classList.add("hidden");
};

/* ===== CALCOLO ===== */
async function calcola(){
  const snap=await getDocs(collection(db,"votes"));
  let res=artists.map((a,i)=>{
    let s=0,c=0;
    snap.forEach(d=>{s+=d.data().votes?.[i]||0;c+=d.data().votes?.[i]!=null});
    return {name:a,avg:c?s/c:0};
  }).sort((a,b)=>a.avg-b.avg);
  top3=res.slice(-3).reverse();
  return res.slice(0,-3);
}

/* ===== PODIO CON DRUM ROLL + COUNTDOWN ===== */
btnReveal.onclick=()=>{
  document.documentElement.requestFullscreen?.();
  document.body.classList.add("regia");

  drumRoll();

  setTimeout(()=>{
    let n=10;
    countdown.textContent=n;
    countdown.classList.remove("hidden");

    const timer=setInterval(()=>{
      beep();
      countdown.textContent=n;
      n--;
      if(n<0){
        clearInterval(timer);
        countdown.classList.add("hidden");
        revealPodium();
      }
    },1000);
  },3000);
};

async function revealPodium(){
  await calcola();
  podium.innerHTML="";
  podium.classList.remove("hidden");

  const order=[2,1,0];
  let i=0;

  function show(){
    if(i>=3)return;
    const t=top3[order[i]];
    podium.innerHTML+=`<div class="podium-box">
      ${["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][order[i]]}<br>${t.name}<br>${t.avg.toFixed(2)}
    </div>`;
    i++;
    setTimeout(show,2000);
  }
  show();
}
</script>
</body>
</html>
