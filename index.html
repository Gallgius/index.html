<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Sanremo 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  color:white;
  min-height:100vh;
  background:url("sfondo.png") no-repeat center 25%;
  background-size:cover;
}

.hidden{display:none}

/* ===== LOGHI ===== */
#logos{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0px;
  margin-bottom:10px;
}
#logos img:first-child{
  max-width:320px;
}

#logos img:last-child{
  max-width:200px;
}


/* ===== BOX ===== */
.box{
  max-width:900px;
  margin:auto;
  background:rgba(0,0,0,.45);
  padding:25px;
  border-radius:14px;
}

input,button{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:8px;
  border:none;
  font-size:16px
}
button{
  background:gold;
  color:black;
  font-weight:bold;
  cursor:pointer
}

/* ===== VOTO ===== */
.artist{margin:10px 0}

/* ===== CLASSIFICA ===== */
.bar{
  background:linear-gradient(90deg,gold,orange);
  height:28px;
  border-radius:10px;
  margin:8px 0;
  padding-left:10px;
  line-height:28px;
  color:black;
  font-weight:bold;
  width:0;
  transition:width 1s;
}

/* ===== PODIO ===== */
#podium{
  display:flex;
  justify-content:center;
  gap:20px;
  margin:30px 0;
}
.podium-box{
  background:gold;
  color:black;
  padding:20px;
  border-radius:16px;
  text-align:center;
  width:30%;
  font-weight:bold;
  font-size:18px;
}

/* ===== REGIA ===== */
.regia input,
.regia button,
.regia h1{
  display:none!important;
}
.regia .box{
  background:none;
}
</style>
</head>

<body>

<div id="logos">
  <img src="logo-sanremo-2026.png" alt="Sanremo 2026">
  <img src="logo-cinema.png" alt="Cinema">
</div>

<div class="box" id="login">
  <input id="nickname" placeholder="Nickname">
  <input id="code" placeholder="Codice votante / Presentatore">
  <button id="btnStart">Entra</button>
</div>

<div class="box hidden" id="vote">
  <h2>Vota tutti i cantanti (1â€“10)</h2>
  <div id="artists"></div>
  <button id="btnSubmit">Invia voti</button>
</div>

<div class="box hidden" id="presenter">
  <button id="btnShow">MOSTRA CLASSIFICA</button>
  <button id="btnReveal">RIVELA PODIO</button>
  <button id="btnReset">RESET</button>
  <div id="ranking"></div>
  <div id="podium" class="hidden"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== FIREBASE ===== */
const firebaseConfig={
  apiKey:"AIzaSyCwqBPd1zFT5SM6e2oUqD09UIF8kOcNisE",
  authDomain:"sanremo-2026.firebaseapp.com",
  projectId:"sanremo-2026",
  storageBucket:"sanremo-2026.appspot.com",
  messagingSenderId:"585160817288",
  appId:"1:585160817288:web:71c4552fc2cfd73c9dfd3d"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* ===== CONFIG ===== */
const PRESENTER_CODE = "SANREMO26";
const VOTER_CODE = "VOTO26";

const artists = [
  { name: "Arisa", song: "Magica favola" },
  { name: "Bambole di Pezza", song: "Resta con me" },
  { name: "Chiello", song: "Ti penso sempre" },
  { name: "Dargen D'Amico", song: "AI AI" },
  { name: "Ditonellapiaga", song: "Che fastidio!" },
  { name: "Eddie Brock", song: "Avvoltoi" },
  { name: "Elettra Lamborghini", song: "VoilÃ " },
  { name: "Enrico Nigiotti", song: "Ogni volta che non so volare" },
  { name: "Ermal Meta", song: "Stella stellina" },
  { name: "Fedez & Marco Masini", song: "Male necessario" },
  { name: "Francesco Renga", song: "Il meglio di me" },
  { name: "Fulminacci", song: "Stupida sfortuna" },
  { name: "J-Ax", song: "Italia" },
  { name: "LDA & Aka7even", song: "Poesie clandestine" },
  { name: "Leo Gassmann", song: "Naturale" },
  { name: "Levante", song: "Sei tu" },
  { name: "LuchÃ¨", song: "Labirinto" },
  { name: "Malika Ayane", song: "Animali notturni" },
  { name: "Mara Sattei", song: "Le cose che non sai di me" },
  { name: "Maria Antonietta & Colombre", song: "La felicitÃ  e basta" },
  { name: "Michele Bravi", song: "Prima o poi" },
  { name: "Nayt", song: "Prima che" },
  { name: "Patty Pravo", song: "Opera" },
  { name: "Raf", song: "Ora e per sempre" },
  { name: "Sal Da Vinci", song: "Per sempre sÃ¬" },
  { name: "Samurai Jay", song: "Ossessione" },
  { name: "Sayf", song: "Tu mi piaci tanto" },
  { name: "Serena Brancale", song: "Qui con me" },
  { name: "Tommaso Paradiso", song: "I romantici" },
  { name: "Tredici Pietro", song: "Uomo che cade" }
];

let votes=Array(artists.length).fill(5);
let top3=[];

/* ===== ELEMENTI ===== */
const login=document.getElementById("login");
const voteBox=document.getElementById("vote");
const presenter=document.getElementById("presenter");
const artistsDiv=document.getElementById("artists");
const ranking=document.getElementById("ranking");
const podium=document.getElementById("podium");
const btnStart = document.getElementById("btnStart");
const btnSubmit = document.getElementById("btnSubmit");
const btnShow = document.getElementById("btnShow");
const btnReveal = document.getElementById("btnReveal");
const btnReset = document.getElementById("btnReset");

const nickname = document.getElementById("nickname");
const code = document.getElementById("code");


/* ===== LOGIN ===== */
btnStart.onclick = () => {
  if (!nickname.value || !code.value) {
    alert("Compila tutto");
    return;
  }

  login.classList.add("hidden");

  if (code.value === PRESENTER_CODE) {
    presenter.classList.remove("hidden");
    return;
  }

  if (code.value === VOTER_CODE) {
    voteBox.classList.remove("hidden");
    renderArtists();
    return;
  }

  alert("Codice non valido");
  login.classList.remove("hidden");
};


    function renderArtists(){
  artistsDiv.innerHTML = "";

  artists.forEach((a, i) => {
    const d = document.createElement("div");
    d.className = "artist";

    d.innerHTML = `
      <strong>${a.name}</strong><br>
      <em style="opacity:.8">${a.song}</em>
      <input type="range" min="1" max="10" value="1">
      <span> 1</span>
    `;

    const r = d.querySelector("input");
    const s = d.querySelector("span");

    r.oninput = () => {
      s.textContent = " " + r.value;
      votes[i] = +r.value;
    };

    artistsDiv.appendChild(d);
  });
}


  } else {
    alert("Codice non valido");
  }
};

/* ===== VOTO ===== */
function renderArtists(){
  artistsDiv.innerHTML = "";

  artists.forEach((a, i) => {
    const d = document.createElement("div");
    d.className = "artist";

    d.innerHTML = `
      <strong>${a.name}</strong><br>
      <em>${a.song}</em><br>
      <input type="range" min="1" max="10" value="1">
      <span> 1</span>
    `;

    const r = d.querySelector("input");
    const s = d.querySelector("span");

    r.oninput = () => {
      s.textContent = " " + r.value;
      votes[i] = +r.value;
    };

    artistsDiv.appendChild(d);
  });
}


btnSubmit.onclick=async()=>{
  await addDoc(collection(db,"votes"),{votes});
  alert("Voto inviato!");
  voteBox.classList.add("hidden");
};

/* ===== CALCOLO ===== */
async function calcola(){
  const snap = await getDocs(collection(db,"votes"));

  let res = artists.map((a, i) => {
    let s = 0, c = 0;

    snap.forEach(d => {
      if (d.data().votes && d.data().votes[i] != null) {
        s += d.data().votes[i];
        c++;
      }
    });

    return {
      name: a.name,
      song: a.song,
      avg: c ? s / c : 0
    };
  }).sort((a, b) => a.avg - b.avg);

  top3 = res.slice(-3).reverse();
  return res.slice(0, -3);
}


/* ===== CLASSIFICA PROGRESSIVA ===== */
btnShow.onclick=async()=>{
  ranking.innerHTML="";
  const others=await calcola();
  let i=0;

  function reveal(){
    if(i>=others.length)return;
    const t=others[i];
    const bar=document.createElement("div");
    bar.className="bar";
    bar.textContent=`${others.length-i+3}. ${t.name} â€“ ${t.avg.toFixed(2)}`;
    ranking.appendChild(bar);
    requestAnimationFrame(()=>bar.style.width=(t.avg*10)+"%");
    i++;
    setTimeout(reveal,500);
  }
  reveal();
};

/* ===== PODIO ===== */
btnReveal.onclick=async()=>{
  document.documentElement.requestFullscreen?.();
  document.body.classList.add("regia");

  await calcola();
  podium.innerHTML="";
  podium.classList.remove("hidden");

  const order=[2,1,0];
  let i=0;

  function show(){
    if(i>=3)return;
    const t=top3[order[i]];
    const d=document.createElement("div");
    d.className="podium-box";
    d.innerHTML=`${["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][order[i]]}<br>${t.name}<br>${t.avg.toFixed(2)}`;
    podium.appendChild(d);
    gold();
    i++;
    setTimeout(show,2000);
  }
  show();
};

/* ===== EFFETTO ORO ===== */
function gold(){
  for(let i=0;i<50;i++){
    const p=document.createElement("div");
    p.style=`position:fixed;width:8px;height:8px;background:gold;border-radius:50%;top:-10px;left:${Math.random()*100}vw`;
    document.body.appendChild(p);
    p.animate([{transform:"translateY(0)"},{transform:"translateY(100vh)",opacity:0}],{duration:2000});
    setTimeout(()=>p.remove(),2200);
  }
}

/* ===== RESET ===== */
btnReset.onclick=async()=>{
  if(!confirm("Reset totale?"))return;
  const snap=await getDocs(collection(db,"votes"));
  for(const d of snap.docs)await deleteDoc(doc(db,"votes",d.id));
  ranking.innerHTML="";
  podium.innerHTML="";
  alert("Reset fatto");
};
  
</script>
</body>
</html>

